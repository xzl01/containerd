From: Shengjing Zhu <zhsj@debian.org>
Date: Sat, 23 Jan 2021 00:42:41 +0800
Subject: disable runhcs option in cri config

Forwarded: not-needed
---
 pkg/cri/sbserver/helpers.go                  | 6 ------
 pkg/cri/server/container_stats_list_linux.go | 3 ---
 pkg/cri/server/helpers.go                    | 3 ---
 3 files changed, 12 deletions(-)

diff --git a/pkg/cri/sbserver/helpers.go b/pkg/cri/sbserver/helpers.go
index eef800f..d7304f6 100644
--- a/pkg/cri/sbserver/helpers.go
+++ b/pkg/cri/sbserver/helpers.go
@@ -44,7 +44,6 @@ import (
 	"github.com/containerd/errdefs"
 	docker "github.com/distribution/reference"
 
-	runhcsoptions "github.com/Microsoft/hcsshim/cmd/containerd-shim-runhcs-v1/options"
 	imagedigest "github.com/opencontainers/go-digest"
 	"github.com/pelletier/go-toml"
 	runtime "k8s.io/cri-api/pkg/apis/runtime/v1"
@@ -90,9 +89,6 @@ const (
 	// defaultIfName is the default network interface for the pods
 	defaultIfName = "eth0"
 
-	// runtimeRunhcsV1 is the runtime type for runhcs.
-	runtimeRunhcsV1 = "io.containerd.runhcs.v1"
-
 	// devShm is the default path of /dev/shm.
 	devShm = "/dev/shm"
 	// etcHosts is the default path of /etc/hosts file.
@@ -405,8 +401,6 @@ func getRuntimeOptionsType(t string) interface{} {
 		return &runcoptions.Options{}
 	case plugin.RuntimeLinuxV1:
 		return &runctypes.RuncOptions{}
-	case runtimeRunhcsV1:
-		return &runhcsoptions.Options{}
 	default:
 		return &runtimeoptions.Options{}
 	}
diff --git a/pkg/cri/server/container_stats_list_linux.go b/pkg/cri/server/container_stats_list_linux.go
index ee46db9..68af207 100644
--- a/pkg/cri/server/container_stats_list_linux.go
+++ b/pkg/cri/server/container_stats_list_linux.go
@@ -22,7 +22,6 @@ import (
 	"reflect"
 	"time"
 
-	wstats "github.com/Microsoft/hcsshim/cmd/containerd-shim-runhcs-v1/stats"
 	v1 "github.com/containerd/cgroups/v3/cgroup1/stats"
 	v2 "github.com/containerd/cgroups/v3/cgroup2/stats"
 	"github.com/containerd/containerd/api/types"
@@ -68,8 +67,6 @@ func (c *criService) containerMetrics(
 			data = &v1.Metrics{}
 		case typeurl.Is(stats.Data, (*v2.Metrics)(nil)):
 			data = &v2.Metrics{}
-		case typeurl.Is(stats.Data, (*wstats.Statistics)(nil)):
-			data = &wstats.Statistics{}
 		default:
 			return nil, errors.New("cannot convert metric data to cgroups.Metrics or windows.Statistics")
 		}
diff --git a/pkg/cri/server/helpers.go b/pkg/cri/server/helpers.go
index 7bdb4af..f9031fc 100644
--- a/pkg/cri/server/helpers.go
+++ b/pkg/cri/server/helpers.go
@@ -43,7 +43,6 @@ import (
 	runtimespec "github.com/opencontainers/runtime-spec/specs-go"
 	"github.com/sirupsen/logrus"
 
-	runhcsoptions "github.com/Microsoft/hcsshim/cmd/containerd-shim-runhcs-v1/options"
 	imagedigest "github.com/opencontainers/go-digest"
 	"github.com/pelletier/go-toml"
 	runtime "k8s.io/cri-api/pkg/apis/runtime/v1"
@@ -374,8 +373,6 @@ func getRuntimeOptionsType(t string) interface{} {
 		return &runcoptions.Options{}
 	case plugin.RuntimeLinuxV1:
 		return &runctypes.RuncOptions{}
-	case runtimeRunhcsV1:
-		return &runhcsoptions.Options{}
 	default:
 		return &runtimeoptions.Options{}
 	}
